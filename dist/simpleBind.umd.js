!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.simpleBind=t()}(this,function(){"use strict";var n,d="FIRST_IN_STRING",l="COLON_SEPARATED_SECOND_GROUP",s="COLON_SEPARATED_THIRD_GROUP",u=function(e){var t=typeof e;switch(t){case"object":return null==e?"null":e instanceof Array?"array":t;default:return t}},e=(n=0,function(e,t){clearTimeout(n),n=setTimeout(e,t)}),c=function(e){for(var t=[],n=0;n<e.length;++n){switch(u(e[n])){case"object":t.push(p({},e[n]));break;case"array":t.push(c(e[n]));break;default:t.push(e[n])}}return t},p=function(){for(var e=arguments,t=1,n=arguments.length;t<n;++t){var i=e[t],r=e[0];for(var a in i){var o="array"===u(i[a]),d="object"!=u(r[a])&&"object"!=u(i[a])&&!o;r[a]=d?i[a]:(r[a]=p(void 0===r[a]?{}:r[a],i[a]),o?c(i[a]):p(void 0===r[a]?{}:r[a],i[a]))}}return arguments.length?arguments[0]:{}},a=function(e){if(Object.keys)return Object.keys(e);for(var t in arr=[],e)arr.push(t);return arr},b=function(e){var t,n,i={};t=o(e),n=a(t);for(var r=0;r<n.length;++r)0===n[r].indexOf("data-")&&(i[n[r].substring(5,n[r].length)]=t[n[r]]);return i},o=function(e){var t,n={};t=e.attributes;for(var i=0;i<t.length;++i){var r=t.item(i);n[r.nodeName]=r.hasOwnProperty("value")?r.value:r.nodeValue}return n};var t=Object.freeze({delay:e,extend:p,getKeys:a,getData:b,getAttrs:o,set:function(e,t,n){for(var i=(t=t.split(".")).pop();t.length;){var r=t.shift();e[r]=void 0===e[r]?{}:e[r],e=e[r]}e[i]=n},get:function(e,t){if("$base"==t||""===t)return e;t=t.split(".");for(var n=0;n<t.length;++n){if("$base"==t[n])return e;if(null==e)return"";if(void 0===e[t[n]])return"";if(null===e)return"";e=e[t[n]]}return e},replaceObjNameInBindingStr:function(e,t,n,i){return e.split(",").map((r=t.objNameLocation,a=n,o=i,function(e){switch(r){case d:return e=e.replace(new RegExp("^"+a+"(.)?"),o+"$1");case l:return e=e.replace(new RegExp("^([^:]+:)"+a+"(\\.)?"),"$1"+o+"$2");case s:return e=e.replace(new RegExp("^([^:]+:[^:]+:)"+a+"(\\.)?"),"$1"+o+"$2")}})).join(",");var r,a,o},triggerEvent:function(e,t){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}else e.fireEvent("on"+t)}}),m={bindTypes:[],bindTypeOpts:{},boundElems:{},boundObjects:{},boundObjectsLast:{},ready:!1,beforeReadyBindQueue:[],autoReBinding:!1,autoReBindingQueue:{},plugins:[]},f=document,i=function(e,t){void 0===t&&(t=!1),t&&(m.autoReBinding=!0,m.autoReBindingQueue={});for(var n=(e=void 0===e?f:e).getElementsByTagName("*"),i=0;i<n.length;++i){var r=b(n[i]);if(void 0===r.simplebindcollected)for(var a=!1,o=0;o<m.bindTypes.length;++o)void 0!==r[m.bindTypes[o]]&&(a||(a=!0,n[i].setAttribute("data-simplebindcollected","true")),r.bindType=m.bindTypes[o],m.bindTypeOpts[m.bindTypes[o]].collection(n[i],r))}t&&(m.autoReBinding=!1,v())},r=function(e,t,n){n=void 0!==n&&n;for(var i=0;i<e.length;++i)m.bindTypeOpts[e[i].bindType].binding&&m.bindTypeOpts[e[i].bindType].binding(e[i],t,n)},v=function(){for(var e in m.autoReBindingQueue)void 0!==m.boundObjects[e]&&r(m.autoReBindingQueue[e],m.boundObjects[e],!0)},g=function(t){for(var n=[],e=arguments.length-1;0<e--;)n[e]=arguments[e+1];switch(t){case"preBind":case"postBind":var i=n[1];return m.plugins.forEach(function(e){return i="function"==typeof e[t]?e[t].apply(null,n):i}),i}};f.addEventListener("DOMContentLoaded",function(){!function(){if(i(),m.ready=!0,m.beforeReadyBindQueue.length)for(var e=0;e<m.beforeReadyBindQueue.length;++e)h.bind(m.beforeReadyBindQueue[e].name,m.beforeReadyBindQueue[e].obj)}()});var h=window.simpleBind||{};h.util=t,h.getState=function(){return m};var y={binding:null};h.registerBindType=function(e,t){void 0===m.bindTypeOpts[e]&&(m.bindTypeOpts[e]={},m.bindTypes.push(e)),p(m.bindTypeOpts[e],y,t)},h.addToBoundElems=function(e,t,n){n.bindType=e,void 0===m.boundElems[t]&&(m.boundElems[t]=[]),m.autoReBinding&&(void 0===m.autoReBindingQueue[t]&&(m.autoReBindingQueue[t]=[]),m.autoReBindingQueue[t].push(n)),m.boundElems[t].push(n)},h.recollectDOM=function(e,t){i(e,t)};var j={preBind:null,postBind:null,name:""};h.registerPlugin=function(e){void 0===e&&(e={}),m.plugins.push(p({},j,e))},h.bind=function(e,t){var n,i;"string"==typeof e&&void 0!==t&&(void 0===m.boundElems[e]&&(m.boundElems[e]=[]),m.ready?(t=g("preBind",e,t),n=e,i=t,void 0===m.boundObjectsLast[n]&&(m.boundObjectsLast[n]={}),m.boundObjects[n]=i,void 0!==m.boundElems[n]&&(r(m.boundElems[n],i),m.boundObjectsLast[n]=p({},i)),t=g("postBind",e,t)):m.beforeReadyBindQueue.push({name:e,obj:t}))},h.extendNamespace=function(e,t){h[e]=t};h.registerBindType("simplebind",{collection:function(e,t){t.simplebind=t.simplebind.split(".");var n={elem:e,objName:t.simplebind.shift(),objKey:t.simplebind.join("."),opts:t};h.addToBoundElems("simplebind",n.objName,n)},binding:function(e,t,n){var i=h.util.get(t,e.objKey);(i!==h.util.get(m.boundObjectsLast[e.objName],e.objKey)||n)&&(void 0!==e.opts.simplefilter&&(i=h.getFilteredValue(i,e.opts.simplefilter)),i="string"==typeof i?i:JSON.stringify(i,null,2),void 0!==e.opts.simplebindhtml&&"true"==e.opts.simplebindhtml?e.elem.innerHTML=i:e.elem.childNodes.length?e.elem.childNodes[0].nodeValue=i:e.elem.appendChild(document.createTextNode(i)))},objNameLocation:d}),m.bindHandlers={};h.registerBindType("simplebindhandler",{collection:function(e,t){for(var n=t.simplebindhandler.split(","),i=0;i<n.length;++i){n[i]=n[i].split(":");var r={elem:e,handler:n[i].shift()};n[i]=n[i].shift().split("."),r.objName=n[i].shift(),r.objKey=n[i].join("."),h.addToBoundElems("simplebindhandler",r.objName,r)}},binding:function(e,t,n){if(void 0!==m.bindHandlers[e.handler]){var i=h.util.get(t,e.objKey),r=h.util.get(m.boundObjectsLast[e.objName],e.objKey);(("object"==typeof i?JSON.stringify(i)!=JSON.stringify(r):i!=r)||n)&&m.bindHandlers[e.handler](e.elem,h.util.get(t,e.objKey),e.objName)}},objNameLocation:l}),h.extendNamespace("registerBindHandler",function(e,t){"function"==typeof t&&(m.bindHandlers[e]=t)});var T="data-simpleeventdispatch",N="data-simplebindvaluechanger",O=function(){if(this.getAttribute(T))return this.removeAttribute(T);var e=this.getAttribute("data-simplebindvalue").split("."),t=e.shift();if(void 0===m.boundObjects[t]&&(m.boundObjects[t]={}),this.setAttribute(N,"true"),h.util.set(m.boundObjects[t],e.join("."),L(this)),h.bind(t,m.boundObjects[t]),-1<t.indexOf("__repeat")){var n=m.repeatDictionary[t.split("-").shift()];h.bind(n,m.boundObjects[n])}},E=function(){var e=this;h.util.delay(function(){O.call(e)},50)},B=function(e){var t=e.tagName.toLowerCase();switch(t){case"input":return e.getAttribute("type");default:return t}},L=function(e){switch(B(e)){case"checkbox":return e.checked;default:return e.value}};h.registerBindType("simplebindvalue",{collection:function(e,t){t.simplebindvalue=t.simplebindvalue.split(".");var n={elem:e,objName:t.simplebindvalue.shift(),objKey:t.simplebindvalue.join("."),inputType:B(e),initiatedChange:!1};!function(e,t){switch(t){case"text":case"tel":case"password":case"textarea":case"number":case"email":case"zip":case"time":e.addEventListener("keyup",E);default:e.addEventListener("change",O)}}(e,n.inputType),h.addToBoundElems("simplebindvalue",n.objName,n)},binding:function(e,t,n){var i=h.util.get(t,e.objKey);!function(e,t){switch(B(e)){case"checkbox":return String(e.checked)!=String(t);case"radio":var n=L(e);return e.checked&&n!=String(t)||!e.checked&&n==String(t);default:return t!=L(e)}}(e.elem,i)?e.elem.getAttribute(N)&&e.elem.removeAttribute(N):e.elem.getAttribute(N)?e.elem.removeAttribute(N):(function(e,t){switch(e.inputType){case"select":for(var n=e.elem.getElementsByTagName("option"),i=0,r=0;r<n.length;++r)if(n[r].value==t){i=r;break}e.elem.selectedIndex=i;break;case"radio":e.elem.checked=String(t)==e.elem.value;break;case"checkbox":e.elem.checked=!0===t||"true"==t;break;case"textarea":e.elem.innerHTML!=t&&(e.elem.innerHTML=t);break;case"text":default:(t!=e.elem.value||flush)&&(e.elem.value=t)}}(e,i),e.elem.setAttribute(T,"true"),h.util.triggerEvent(e.elem,"change"))},objNameLocation:d}),m.repeatCount=0,m.repeatDictionary={};var R=function(e,t){return"__repeat"+e.repeatIndex+"-"+e.innerObjName+t},x=function(e,t,n){for(var i=0;i<e.length;++i)for(var r=0;r<m.bindTypes.length;++r){var a="data-"+m.bindTypes[r],o=e[i].getAttribute(a);if(o){var d=h.util.replaceObjNameInBindingStr(o,m.bindTypeOpts[m.bindTypes[r]],t,n);d!=o&&e[i].setAttribute(a,d),e[i].removeAttribute("data-simplebindcollected")}}};h.registerBindType("simplerepeat",{collection:function(e,t){t.simplerepeat=t.simplerepeat.split(":");var n=t.simplerepeat.pop().split("."),i={elem:e,objName:n.shift(),objKey:n.join("."),innerObjName:t.simplerepeat.shift(),repeatedElems:[],repeatIndex:m.repeatCount},r=e.getElementsByTagName("*");x(r,i.innerObjName,R(i,0)),i.repeatTemplate=r[0].parentNode.removeChild(r[0]),m.repeatDictionary["__repeat"+i.repeatIndex]=i.objName,++m.repeatCount,h.addToBoundElems("simplerepeat",i.objName,i)},binding:function(e,t,n){var i=h.util.get(t,e.objKey)||[];if(void 0!==i.length){!function(e,t){var n;if(e.repeatedElems.length!=t)if(e.repeatedElems.length<t){n=t-e.repeatedElems.length;for(var i=document.createDocumentFragment(),r=0;r<n;++r){var a=e.repeatTemplate.cloneNode(!0),o=a.getElementsByTagName("*"),d=R(e,0),l=R(e,e.repeatedElems.length);x([a],d,l),x(o,d,l),e.repeatedElems.push(a),i.appendChild(a)}e.elem.appendChild(i),h.recollectDOM(e.elem,!0)}else for(n=e.repeatedElems.length-t,r=0;r<n;++r){var s=e.repeatedElems.pop(),u=R(e,e.repeatedElems.length);s.parentNode.removeChild(s),void 0!==m.boundElems[u]&&delete m.boundElems[u],void 0!==m.boundObjects[u]&&delete m.boundObjects[u],void 0!==m.boundObjectsLast[u]&&delete m.boundObjectsLast[u]}}(e,i.length);for(var r=0;r<i.length;++r)h.bind(R(e,r),i[r])}},objNameLocation:l}),h.extendNamespace("rewriteBindings",x),m.eventHandlers={};var A=function(e,t,n,i,r,a){e.addEventListener(t,function(e){if(void 0!==m.eventHandlers[n])return i&&void 0!==m.boundObjects[r]?void m.eventHandlers[n].call(this,e,h.util.get(m.boundObjects[r],a)):m.eventHandlers[n].call(this,e,void 0)})};h.registerBindType("simpleevent",{collection:function(e,t){for(var n=t.simpleevent.split(","),i=0;i<n.length;++i){var r=n[i].split(":"),a=r.shift(),o=r.shift(),d=!!r.length&&r.shift().split(".");if(d){var l=d.shift(),s=d.join(".");A(e,a,o,d,l,s)}else A(e,a,o,d)}},binding:null,objNameLocation:s}),h.extendNamespace("registerEvent",function(e,t){m.eventHandlers[e]=t});h.registerBindType("simplebindattrs",{collection:function(e,t){for(var n=t.simplebindattrs.split(","),i=0;i<n.length;++i){n[i]=n[i].split(":");var r={elem:e,attr:n[i].shift()};n[i]=n[i].shift().split("."),r.objName=n[i].shift(),r.objKey=n[i].join("."),h.addToBoundElems("simplebindattrs",r.objName,r)}},binding:function(e,t,n){var i=h.util.get(t,e.objKey);(i!=h.util.get(m.boundObjectsLast[e.objName],e.objKey)||n)&&e.elem.setAttribute(e.attr,i)},objNameLocation:l});h.registerBindType("simpledata",{collection:function(e,t){for(var n=t.simpledata.split(","),i=0;i<n.length;++i){var r=n[i].split(":"),a=r.shift(),o={elem:e,objName:(r=r.shift().split(".")).shift(),objKey:r.join("."),prop:a};h.addToBoundElems("simpledata",o.objName,o)}},binding:function(e,t){var n="data-"+e.prop.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2");e.elem.setAttribute(n,h.util.get(t,e.objKey))},objNameLocation:l}),m.filters={};return h.extendNamespace("getFilteredValue",function(e,t){t=t.split(",");for(var n=0;n<t.length;++n)void 0!==m.filters[t[n]]&&(e=m.filters[t[n]](e));return e}),h.extendNamespace("registerFilter",function(e,t){"function"==typeof t&&(m.filters[e]=t)}),h});
//# sourceMappingURL=simpleBind.umd.js.map
