!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.simpleBind=t()}(this,function(){"use strict";var n,l="FIRST_IN_STRING",s="COLON_SEPARATED_SECOND_GROUP",d="COLON_SEPARATED_THIRD_GROUP",u=function(e){var t=typeof e;switch(t){case"object":return null==e?"null":e instanceof Array?"array":t;default:return t}},e=(n=0,function(e,t){clearTimeout(n),n=setTimeout(e,t)}),c=function(e){for(var t=[],n=0;n<e.length;++n){switch(u(e[n])){case"object":t.push(p({},e[n]));break;case"array":t.push(c(e[n]));break;default:t.push(e[n])}}return t},p=function(){for(var e=arguments,t=1,n=arguments.length;t<n;++t){var i=e[t],a=e[0];for(var r in i){var o="array"===u(i[r]),l="object"!=u(a[r])&&"object"!=u(i[r])&&!o;a[r]=l?i[r]:(a[r]=p(void 0===a[r]?{}:a[r],i[r]),o?c(i[r]):p(void 0===a[r]?{}:a[r],i[r]))}}return arguments.length?arguments[0]:{}},r=function(e){if(Object.keys)return Object.keys(e);for(var t in arr=[],e)arr.push(t);return arr},b=function(e){var t,n,i={};t=o(e),n=r(t);for(var a=0;a<n.length;++a)0===n[a].indexOf("data-")&&(i[n[a].substring(5,n[a].length)]=t[n[a]]);return i},o=function(e){var t,n={};t=e.attributes;for(var i=0;i<t.length;++i){var a=t.item(i);n[a.nodeName]=a.hasOwnProperty("value")?a.value:a.nodeValue}return n};function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var t=Object.freeze({delay:e,extend:p,getKeys:r,getData:b,getAttrs:o,set:function(e,t,n){for(var i=(t=t.split(".")).pop();t.length;){var a=t.shift();e[a]=void 0===e[a]?{}:e[a],e=e[a]}e[i]=n},get:function(e,t){if("$base"==t||""===t)return e;t=t.split(".");for(var n=0;n<t.length;++n){if("$base"==t[n])return e;if(null==e)return"";if(void 0===e[t[n]])return"";if(null===e)return"";e=e[t[n]]}return e},replaceObjNameInBindingStr:function(e,t,n,i){return e.split(",").map((a=t.objNameLocation,r=n,o=i,function(e){switch(a){case l:return e=e.replace(new RegExp("^"+m(r)+"(.)?"),o+"$1");case s:return e=e.replace(new RegExp("^([^:]+:)"+m(r)+"(\\.)?"),"$1"+o+"$2");case d:return e=e.replace(new RegExp("^([^:]+:[^:]+:)"+m(r)+"(\\.)?"),"$1"+o+"$2")}})).join(",");var a,r,o},triggerEvent:function(e,t){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}else e.fireEvent("on"+t)}}),f={bindTypes:[],bindTypeOpts:{},boundElems:{},boundObjects:{},boundObjectsLast:{},ready:!1,beforeReadyBindQueue:[],autoReBinding:!1,autoReBindingQueue:{},plugins:[]},v=document,i=function(e,t){void 0===t&&(t=!1),t&&(f.autoReBinding=!0,f.autoReBindingQueue={});for(var n=(e=void 0===e?v:e).getElementsByTagName("*"),i=0;i<n.length;++i){var a=b(n[i]);if(void 0===a.simplebindcollected)for(var r=!1,o=0;o<f.bindTypes.length;++o)void 0!==a[f.bindTypes[o]]&&(r||(r=!0,n[i].setAttribute("data-simplebindcollected","true")),a.bindType=f.bindTypes[o],f.bindTypeOpts[f.bindTypes[o]].collection(n[i],a))}t&&(f.autoReBinding=!1,g())},a=function(e,t,n){n=void 0!==n&&n;for(var i=0;i<e.length;++i)f.bindTypeOpts[e[i].bindType].binding&&f.bindTypeOpts[e[i].bindType].binding(e[i],t,n)},g=function(){for(var e in f.autoReBindingQueue)void 0!==f.boundObjects[e]&&a(f.autoReBindingQueue[e],f.boundObjects[e],!0)},h=function(t){for(var n=[],e=arguments.length-1;0<e--;)n[e]=arguments[e+1];switch(t){case"preBind":case"postBind":var i=n[1];return f.plugins.forEach(function(e){return i="function"==typeof e[t]?e[t].apply(null,n):i}),i}};v.addEventListener("DOMContentLoaded",function(){!function(){if(i(),f.ready=!0,f.beforeReadyBindQueue.length)for(var e=0;e<f.beforeReadyBindQueue.length;++e)j.bind(f.beforeReadyBindQueue[e].name,f.beforeReadyBindQueue[e].obj)}()});var j=window.simpleBind||{};j.util=t,j.getState=function(){return f};var y={binding:null};j.registerBindType=function(e,t){void 0===f.bindTypeOpts[e]&&(f.bindTypeOpts[e]={},f.bindTypes.push(e)),p(f.bindTypeOpts[e],y,t)},j.addToBoundElems=function(e,t,n){n.bindType=e,void 0===f.boundElems[t]&&(f.boundElems[t]=[]),f.autoReBinding&&(void 0===f.autoReBindingQueue[t]&&(f.autoReBindingQueue[t]=[]),f.autoReBindingQueue[t].push(n)),f.boundElems[t].push(n)},j.recollectDOM=function(e,t){i(e,t)};var N={preBind:null,postBind:null,name:""};j.registerPlugin=function(e){void 0===e&&(e={}),f.plugins.push(p({},N,e))},j.bind=function(e,t){var n,i;"string"==typeof e&&void 0!==t&&(void 0===f.boundElems[e]&&(f.boundElems[e]=[]),f.ready?(t=h("preBind",e,t),n=e,i=t,void 0===f.boundObjectsLast[n]&&(f.boundObjectsLast[n]={}),f.boundObjects[n]=i,void 0!==f.boundElems[n]&&(a(f.boundElems[n],i),f.boundObjectsLast[n]=p({},i)),t=h("postBind",e,t)):f.beforeReadyBindQueue.push({name:e,obj:t}))},j.extendNamespace=function(e,t){j[e]=t};j.registerBindType("simplebind",{collection:function(e,t){t.simplebind=t.simplebind.split(".");var n={elem:e,objName:t.simplebind.shift(),objKey:t.simplebind.join("."),opts:t};j.addToBoundElems("simplebind",n.objName,n)},binding:function(e,t,n){var i=j.util.get(t,e.objKey);(i!==j.util.get(f.boundObjectsLast[e.objName],e.objKey)||n)&&(void 0!==e.opts.simplefilter&&(i=j.getFilteredValue(i,e.opts.simplefilter)),i="string"==typeof i?i:JSON.stringify(i,null,2),void 0!==e.opts.simplebindhtml&&"true"==e.opts.simplebindhtml?e.elem.innerHTML=i:e.elem.childNodes.length?e.elem.childNodes[0].nodeValue=i:e.elem.appendChild(document.createTextNode(i)))},objNameLocation:l});var T=j.addToBoundElems,O=j.registerBindType,E=j.getState();O("simplebindclass",{collection:function(r,e){e.simplebindclass.split(",").forEach(function(e){var t=e.match(/^([^:]+):/),n=e.match(/:([^\.]+)\./),i=e.match(/:[^\.]+\.(.*)$/);if(t&&n&&i){var a={elem:r,classNames:t[1].split(/\s+/),objName:n[1],objKey:i[1]};T("simplebindclass",a.objName,a)}})},binding:function(e,t,n){var i,a=j.util.get(t,e.objKey);(a!=j.util.get(E.boundObjectsLast[e.objName],e.objKey)||n)&&(i=e.elem.classList)[1==a?"add":"remove"].apply(i,e.classNames)},objNameLocation:s}),f.bindHandlers={};j.registerBindType("simplebindhandler",{collection:function(e,t){for(var n=t.simplebindhandler.split(","),i=0;i<n.length;++i){n[i]=n[i].split(":");var a={elem:e,handler:n[i].shift()};n[i]=n[i].shift().split("."),a.objName=n[i].shift(),a.objKey=n[i].join("."),j.addToBoundElems("simplebindhandler",a.objName,a)}},binding:function(e,t,n){if(void 0!==f.bindHandlers[e.handler]){var i=j.util.get(t,e.objKey),a=j.util.get(f.boundObjectsLast[e.objName],e.objKey);(("object"==typeof i?JSON.stringify(i)!=JSON.stringify(a):i!=a)||n)&&f.bindHandlers[e.handler](e.elem,j.util.get(t,e.objKey),e.objName)}},objNameLocation:s}),j.extendNamespace("registerBindHandler",function(e,t){"function"==typeof t&&(f.bindHandlers[e]=t)});var B="data-simpleeventdispatch",L="data-simplebindvaluechanger",R=function(){if(this.getAttribute(B))return this.removeAttribute(B);var e=this.getAttribute("data-simplebindvalue").split("."),t=e.shift();if(void 0===f.boundObjects[t]&&(f.boundObjects[t]={}),this.setAttribute(L,"true"),j.util.set(f.boundObjects[t],e.join("."),K(this)),j.bind(t,f.boundObjects[t]),-1<t.indexOf("__repeat")){var n=f.repeatDictionary[t.split("-").shift()];j.bind(n,f.boundObjects[n])}},x=function(){var e=this;j.util.delay(function(){R.call(e)},50)},A=function(e){var t=e.tagName.toLowerCase();switch(t){case"input":return e.getAttribute("type");default:return t}},K=function(e){switch(A(e)){case"checkbox":return e.checked;default:return e.value}};j.registerBindType("simplebindvalue",{collection:function(e,t){t.simplebindvalue=t.simplebindvalue.split(".");var n={elem:e,objName:t.simplebindvalue.shift(),objKey:t.simplebindvalue.join("."),inputType:A(e),initiatedChange:!1};!function(e,t){switch(t){case"text":case"tel":case"password":case"textarea":case"number":case"email":case"zip":case"time":e.addEventListener("keyup",x);default:e.addEventListener("change",R)}}(e,n.inputType),j.addToBoundElems("simplebindvalue",n.objName,n)},binding:function(e,t,n){var i=j.util.get(t,e.objKey);!function(e,t){switch(A(e)){case"checkbox":return String(e.checked)!=String(t);case"radio":var n=K(e);return e.checked&&n!=String(t)||!e.checked&&n==String(t);default:return t!=K(e)}}(e.elem,i)?e.elem.getAttribute(L)&&e.elem.removeAttribute(L):e.elem.getAttribute(L)?e.elem.removeAttribute(L):(function(e,t){switch(e.inputType){case"select":for(var n=e.elem.getElementsByTagName("option"),i=0,a=0;a<n.length;++a)if(n[a].value==t){i=a;break}e.elem.selectedIndex=i;break;case"radio":e.elem.checked=String(t)==e.elem.value;break;case"checkbox":e.elem.checked=!0===t||"true"==t;break;case"textarea":e.elem.innerHTML!=t&&(e.elem.innerHTML=t);break;case"text":default:(t!=e.elem.value||flush)&&(e.elem.value=t)}}(e,i),e.elem.setAttribute(B,"true"),j.util.triggerEvent(e.elem,"change"))},objNameLocation:l}),f.repeatCount=0,f.repeatDictionary={};var k=function(e,t){return"__repeat"+e.repeatIndex+"-"+e.innerObjName+t},w=function(e,t,n){for(var i=0;i<e.length;++i)for(var a=0;a<f.bindTypes.length;++a){var r="data-"+f.bindTypes[a],o=e[i].getAttribute(r);if(o){var l=j.util.replaceObjNameInBindingStr(o,f.bindTypeOpts[f.bindTypes[a]],t,n);l!=o&&e[i].setAttribute(r,l),e[i].removeAttribute("data-simplebindcollected")}}};j.registerBindType("simplerepeat",{collection:function(e,t){t.simplerepeat=t.simplerepeat.split(":");var n=t.simplerepeat.pop().split("."),i={elem:e,objName:n.shift(),objKey:n.join("."),innerObjName:t.simplerepeat.shift(),repeatedElems:[],repeatIndex:f.repeatCount},a=e.getElementsByTagName("*");w(a,i.innerObjName,k(i,0)),i.repeatTemplate=a[0].parentNode.removeChild(a[0]),f.repeatDictionary["__repeat"+i.repeatIndex]=i.objName,++f.repeatCount,j.addToBoundElems("simplerepeat",i.objName,i)},binding:function(e,t,n){var i=j.util.get(t,e.objKey)||[];if(void 0!==i.length){!function(e,t){var n;if(e.repeatedElems.length!=t)if(e.repeatedElems.length<t){n=t-e.repeatedElems.length;for(var i=document.createDocumentFragment(),a=0;a<n;++a){var r=e.repeatTemplate.cloneNode(!0),o=r.getElementsByTagName("*"),l=k(e,0),s=k(e,e.repeatedElems.length);w([r],l,s),w(o,l,s),e.repeatedElems.push(r),i.appendChild(r)}e.elem.appendChild(i),j.recollectDOM(e.elem,!0)}else for(n=e.repeatedElems.length-t,a=0;a<n;++a){var d=e.repeatedElems.pop(),u=k(e,e.repeatedElems.length);d.parentNode.removeChild(d),void 0!==f.boundElems[u]&&delete f.boundElems[u],void 0!==f.boundObjects[u]&&delete f.boundObjects[u],void 0!==f.boundObjectsLast[u]&&delete f.boundObjectsLast[u]}}(e,i.length);for(var a=0;a<i.length;++a)j.bind(k(e,a),i[a])}},objNameLocation:s}),j.extendNamespace("rewriteBindings",w),f.eventHandlers={};var S=function(e,t,n,i,a,r){e.addEventListener(t,function(e){if(void 0!==f.eventHandlers[n])return i&&void 0!==f.boundObjects[a]?void f.eventHandlers[n].call(this,e,j.util.get(f.boundObjects[a],r)):f.eventHandlers[n].call(this,e,void 0)})};j.registerBindType("simpleevent",{collection:function(e,t){for(var n=t.simpleevent.split(","),i=0;i<n.length;++i){var a=n[i].split(":"),r=a.shift(),o=a.shift(),l=!!a.length&&a.shift().split(".");if(l){var s=l.shift(),d=l.join(".");S(e,r,o,l,s,d)}else S(e,r,o,l)}},binding:null,objNameLocation:d}),j.extendNamespace("registerEvent",function(e,t){f.eventHandlers[e]=t});j.registerBindType("simplebindattrs",{collection:function(e,t){for(var n=t.simplebindattrs.split(","),i=0;i<n.length;++i){n[i]=n[i].split(":");var a={elem:e,attr:n[i].shift()};n[i]=n[i].shift().split("."),a.objName=n[i].shift(),a.objKey=n[i].join("."),j.addToBoundElems("simplebindattrs",a.objName,a)}},binding:function(e,t,n){var i=j.util.get(t,e.objKey);(i!=j.util.get(f.boundObjectsLast[e.objName],e.objKey)||n)&&e.elem.setAttribute(e.attr,i)},objNameLocation:s});j.registerBindType("simpledata",{collection:function(e,t){for(var n=t.simpledata.split(","),i=0;i<n.length;++i){var a=n[i].split(":"),r=a.shift(),o={elem:e,objName:(a=a.shift().split(".")).shift(),objKey:a.join("."),prop:r};j.addToBoundElems("simpledata",o.objName,o)}},binding:function(e,t){var n="data-"+e.prop.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2");e.elem.setAttribute(n,j.util.get(t,e.objKey))},objNameLocation:s}),f.filters={};return j.extendNamespace("getFilteredValue",function(e,t){t=t.split(",");for(var n=0;n<t.length;++n)void 0!==f.filters[t[n]]&&(e=f.filters[t[n]](e));return e}),j.extendNamespace("registerFilter",function(e,t){"function"==typeof t&&(f.filters[e]=t)}),j});
//# sourceMappingURL=simpleBind.umd.js.map
