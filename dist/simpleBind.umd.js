!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.simpleBind=t()}(this,function(){"use strict";var n,i=document,s=function(e){var t=typeof e;switch(t){case"object":return null==e?"null":e instanceof Array?"array":t;default:return t}},l=function(e){for(var t=[],n=0;n<e.length;++n){switch(s(e[n])){case"object":t.push(u({},e[n]));break;case"array":t.push(l(e[n]));break;default:t.push(e[n])}}return t},e=(n=0,function(e,t){clearTimeout(n),n=setTimeout(e,t)}),u=function(){return function(e){for(var t=1,n=e.length;t<n;++t){var i=e[t],r=e[0];for(var a in i){var d="array"===s(i[a]),o="object"!=s(r[a])&&"object"!=s(i[a])&&!d;r[a]=o?i[a]:(r[a]=u(void 0===r[a]?{}:r[a],i[a]),d?l(i[a]):u(void 0===r[a]?{}:r[a],i[a]))}}return e.length?e[0]:{}}(arguments)},a=function(e){if(Object.keys)return Object.keys(e);for(var t in arr=[],e)arr.push(t);return arr},o=function(e){var t,n,i={};t=d(e),n=a(t);for(var r=0;r<n.length;++r)0===n[r].indexOf("data-")&&(i[n[r].substring(5,n[r].length)]=t[n[r]]);return i},d=function(e){var t,n={};t=e.attributes;for(var i=0;i<t.length;++i){var r=t.item(i);n[r.nodeName]=r.hasOwnProperty("value")?r.value:r.nodeValue}return n},r=new RegExp(/^[^\.]*/),p=function(e,t,n){return e==t?e=n:0==e.indexOf(t+".")&&(e=e.replace(r,n)),e},t=Object.freeze({delay:e,extend:u,getKeys:a,getData:o,getAttrs:d,set:function(e,t,n){for(var i=(t=t.split(".")).pop();t.length;){var r=t.shift();e[r]=void 0===e[r]?{}:e[r],e=e[r]}e[i]=n},get:function(e,t){if("$base"==t||""===t)return e;t=t.split(".");for(var n=0;n<t.length;++n){if("$base"==t[n])return e;if(null==e)return"";if(void 0===e[t[n]])return"";if(null===e)return"";e=e[t[n]]}return e},replaceObjNameInBindingStr:function(e,t,n,i){if(-1<e.indexOf(":"))switch(t){case"simplerepeat":(e=e.split(":"))[1]=p(e[1],n,i),e=e.join(":");break;case"simpleevent":3<=(e=e.split(":")).length&&(e[2]=p(e[2],n,i)),e=e.join(":");break;case"simplebindhandler":case"simpledata":case"simplebindattrs":default:e=e.split(",");for(var r=0;r<e.length;++r)e[r]=e[r].split(":"),1<e[r].length&&(e[r][1]=p(e[r][1],n,i)),e[r]=e[r].join(":");e=e.join(",")}else e=p(e,n,i);return e},triggerEvent:function(e,t){if("createEvent"in i){var n=i.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}else e.fireEvent("on"+t)}}),b={bindTypes:[],bindTypeOpts:{},boundElems:{},boundObjects:{},boundObjectsLast:{},ready:!1,beforeReadyBindQueue:[],autoReBinding:!1,autoReBindingQueue:{}},c=document,f=function(e,t){(t=void 0!==t&&t)&&(b.autoReBinding=!0,b.autoReBindingQueue={});for(var n=(e=void 0===e?c:e).getElementsByTagName("*"),i=0;i<n.length;++i){var r=o(n[i]);if(void 0===r.simplebindcollected)for(var a=!1,d=0;d<b.bindTypes.length;++d)void 0!==r[b.bindTypes[d]]&&(a||(a=!0,n[i].setAttribute("data-simplebindcollected","true")),r.bindType=b.bindTypes[d],b.bindTypeOpts[b.bindTypes[d]].collection(n[i],r))}t&&(b.autoReBinding=!1,v())},m=function(e,t,n){n=void 0!==n&&n;for(var i=0;i<e.length;++i)b.bindTypeOpts[e[i].bindType].binding&&b.bindTypeOpts[e[i].bindType].binding(e[i],t,n)},v=function(){for(var e in b.autoReBindingQueue)void 0!==b.boundObjects[e]&&m(b.autoReBindingQueue[e],b.boundObjects[e],!0)};c.addEventListener("DOMContentLoaded",function(){!function(){if(f(),b.ready=!0,b.beforeReadyBindQueue.length)for(var e=0;e<b.beforeReadyBindQueue.length;++e)g.bind(b.beforeReadyBindQueue[e].name,b.beforeReadyBindQueue[e].obj)}()});var g=window.simpleBind||{};g.util=t,g.getState=function(){return b},g.registerBindType=function(e,t,n){void 0===b.bindTypeOpts[e]&&(b.bindTypeOpts[e]={},b.bindTypes.push(e)),b.bindTypeOpts[e].collection=t,b.bindTypeOpts[e].binding=n},g.addToBoundElems=function(e,t,n){n.bindType=e,void 0===b.boundElems[t]&&(b.boundElems[t]=[]),b.autoReBinding&&(void 0===b.autoReBindingQueue[t]&&(b.autoReBindingQueue[t]=[]),b.autoReBindingQueue[t].push(n)),b.boundElems[t].push(n)},g.recollectDOM=function(e,t){f(e,t)},g.bind=function(e,t){var n,i;"string"==typeof e&&"object"==typeof t&&(void 0===b.boundElems[e]&&(b.boundElems[e]=[]),b.ready?(n=e,i=t,void 0===b.boundObjectsLast[n]&&(b.boundObjectsLast[n]={}),b.boundObjects[n]=i,void 0!==b.boundElems[n]&&(m(b.boundElems[n],i),b.boundObjectsLast[n]=u({},i))):b.beforeReadyBindQueue.push({name:e,obj:t}))},g.extendNamespace=function(e,t){g[e]=t};g.registerBindType("simplebind",function(e,t){t.simplebind=t.simplebind.split(".");var n={elem:e,objName:t.simplebind.shift(),objKey:t.simplebind.join("."),opts:t};g.addToBoundElems("simplebind",n.objName,n)},function(e,t,n){var i=g.util.get(t,e.objKey);(i!==g.util.get(b.boundObjectsLast[e.objName],e.objKey)||n)&&(void 0!==e.opts.simplefilter&&(i=g.getFilteredValue(i,e.opts.simplefilter)),i="string"==typeof i?i:JSON.stringify(i,null,2),void 0!==e.opts.simplebindhtml&&"true"==e.opts.simplebindhtml?e.elem.innerHTML=i:e.elem.childNodes.length?e.elem.childNodes[0].nodeValue=i:e.elem.appendChild(document.createTextNode(i)))}),b.bindHandlers={};g.registerBindType("simplebindhandler",function(e,t){for(var n=t.simplebindhandler.split(","),i=0;i<n.length;++i){n[i]=n[i].split(":");var r={elem:e,handler:n[i].shift()};n[i]=n[i].shift().split("."),r.objName=n[i].shift(),r.objKey=n[i].join("."),g.addToBoundElems("simplebindhandler",r.objName,r)}},function(e,t,n){if(void 0!==b.bindHandlers[e.handler]){var i=g.util.get(t,e.objKey),r=g.util.get(b.boundObjectsLast[e.objName],e.objKey);(("object"==typeof i?JSON.stringify(i)!=JSON.stringify(r):i!=r)||n)&&b.bindHandlers[e.handler](e.elem,g.util.get(t,e.objKey),e.objName)}}),g.extendNamespace("registerBindHandler",function(e,t){"function"==typeof t&&(b.bindHandlers[e]=t)});var h="data-simpleeventdispatch",y="data-simplebindvaluechanger",j=function(){if(this.getAttribute(h))this.removeAttribute(h);else{var e=this.getAttribute("data-simplebindvalue").split("."),t=e.shift();if(void 0===b.boundObjects[t]&&(b.boundObjects[t]={}),g.util.set(b.boundObjects[t],e.join("."),E(this)),g.bind(t,b.boundObjects[t]),this.setAttribute(y,"true"),-1<t.indexOf("__repeat")){var n=b.repeatDictionary[t.split("-").shift()];g.bind(n,b.boundObjects[n])}}},T=function(){var e=this;g.util.delay(function(){j.call(e)},50)},O=function(e){var t=e.tagName.toLowerCase();switch(t){case"input":return e.getAttribute("type");default:return t}},E=function(e){switch(O(e)){case"checkbox":return e.checked;default:return e.value}};g.registerBindType("simplebindvalue",function(e,t){t.simplebindvalue=t.simplebindvalue.split(".");var n={elem:e,objName:t.simplebindvalue.shift(),objKey:t.simplebindvalue.join("."),inputType:O(e),initiatedChange:!1};!function(e,t){switch(t){case"text":case"tel":case"password":case"textarea":case"zip":e.addEventListener("keyup",T);default:e.addEventListener("change",j)}}(e,n.inputType),g.addToBoundElems("simplebindvalue",n.objName,n)},function(e,t,n){var i=g.util.get(t,e.objKey);!function(e,t){switch(O(e)){case"checkbox":return String(e.checked)!=String(t);case"radio":var n=E(e);return e.checked&&n!=String(t)||!e.checked&&n==String(t);default:return t!=E(e)}}(e.elem,i)?e.elem.getAttribute(y)&&e.elem.removeAttribute(y):e.elem.getAttribute(y)?e.elem.removeAttribute(y):(function(e,t){switch(e.inputType){case"select":for(var n=e.elem.getElementsByTagName("option"),i=0,r=0;r<n.length;++r)if(n[r].value==t){i=r;break}e.elem.selectedIndex=i;break;case"radio":e.elem.checked=String(t)==e.elem.value;break;case"checkbox":e.elem.checked=!0===t||"true"==t;break;case"textarea":e.elem.innerHTML!=t&&(e.elem.innerHTML=t);break;case"text":default:(t!=e.elem.value||flush)&&(e.elem.value=t)}}(e,i),e.elem.setAttribute(h,"true"),g.util.triggerEvent(e.elem,"change"))}),b.repeatCount=0,b.repeatDictionary={};var N=function(e,t){return"__repeat"+e.repeatIndex+"-"+e.innerObjName+t},B=function(e,t,n){for(var i=0;i<e.length;++i)for(var r=0;r<b.bindTypes.length;++r){var a="data-"+b.bindTypes[r],d=e[i].getAttribute(a);if(d){var o=g.util.replaceObjNameInBindingStr(d,b.bindTypes[r],t,n);o!=d&&e[i].setAttribute(a,o),e[i].removeAttribute("data-simplebindcollected")}}};g.registerBindType("simplerepeat",function(e,t){t.simplerepeat=t.simplerepeat.split(":");var n=t.simplerepeat.pop().split("."),i={elem:e,objName:n.shift(),objKey:n.join("."),innerObjName:t.simplerepeat.shift(),repeatedElems:[],repeatIndex:b.repeatCount},r=e.getElementsByTagName("*");B(r,i.innerObjName,N(i,0)),i.repeatTemplate=r[0].parentNode.removeChild(r[0]),b.repeatDictionary["__repeat"+i.repeatIndex]=i.objName,++b.repeatCount,g.addToBoundElems("simplerepeat",i.objName,i)},function(e,t,n){var i=g.util.get(t,e.objKey)||[];if(void 0!==i.length){!function(e,t){var n;if(e.repeatedElems.length!=t)if(e.repeatedElems.length<t){n=t-e.repeatedElems.length;for(var i=document.createDocumentFragment(),r=0;r<n;++r){var a=e.repeatTemplate.cloneNode(!0),d=a.getElementsByTagName("*"),o=N(e,0),s=N(e,e.repeatedElems.length);B([a],o,s),B(d,o,s),e.repeatedElems.push(a),i.appendChild(a)}e.elem.appendChild(i),g.recollectDOM(e.elem,!0)}else for(n=e.repeatedElems.length-t,r=0;r<n;++r){var l=e.repeatedElems.pop(),u=N(e,e.repeatedElems.length);l.parentNode.removeChild(l),void 0!==b.boundElems[u]&&delete b.boundElems[u],void 0!==b.boundObjects[u]&&delete b.boundObjects[u],void 0!==b.boundObjectsLast[u]&&delete b.boundObjectsLast[u]}}(e,i.length);for(var r=0;r<i.length;++r)g.bind(N(e,r),i[r])}}),g.extendNamespace("rewriteBindings",B),b.eventHandlers={};var x=function(e,t,n,i,r,a){e.addEventListener(t,function(e){if(void 0!==b.eventHandlers[n])return i&&void 0!==b.boundObjects[r]?void b.eventHandlers[n].call(this,e,g.util.get(b.boundObjects[r],a)):b.eventHandlers[n].call(this,e,void 0)})};g.registerBindType("simpleevent",function(e,t){for(var n=t.simpleevent.split(","),i=0;i<n.length;++i){var r=n[i].split(":"),a=r.shift(),d=r.shift(),o=!!r.length&&r.shift().split(".");if(o){var s=o.shift(),l=o.join(".");x(e,a,d,o,s,l)}else x(e,a,d,o)}},null),g.extendNamespace("registerEvent",function(e,t){b.eventHandlers[e]=t});g.registerBindType("simplebindattrs",function(e,t){for(var n=t.simplebindattrs.split(","),i=0;i<n.length;++i){n[i]=n[i].split(":");var r={elem:e,attr:n[i].shift()};n[i]=n[i].shift().split("."),r.objName=n[i].shift(),r.objKey=n[i].join("."),g.addToBoundElems("simplebindattrs",r.objName,r)}},function(e,t,n){var i=g.util.get(t,e.objKey);(i!=g.util.get(b.boundObjectsLast[e.objName],e.objKey)||n)&&e.elem.setAttribute(e.attr,i)});g.registerBindType("simpledata",function(e,t){for(var n=t.simpledata.split(","),i=0;i<n.length;++i){var r=n[i].split(":"),a=r.shift(),d={elem:e,objName:(r=r.shift().split(".")).shift(),objKey:r.join("."),prop:a};g.addToBoundElems("simpledata",d.objName,d)}},function(e,t){var n="data-"+e.prop.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2");e.elem.setAttribute(n,g.util.get(t,e.objKey))}),b.filters={};return g.extendNamespace("getFilteredValue",function(e,t){t=t.split(",");for(var n=0;n<t.length;++n)void 0!==b.filters[t[n]]&&(e=b.filters[t[n]](e));return e}),g.extendNamespace("registerFilter",function(e,t){"function"==typeof t&&(b.filters[e]=t)}),g});
